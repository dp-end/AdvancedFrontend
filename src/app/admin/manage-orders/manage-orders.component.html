<div class="admin-page-container">
  <h1>SipariÅŸleri YÃ¶net</h1>

  <div *ngIf="isLoading" class="loading-state">
    <p>ğŸ”„ SipariÅŸler yÃ¼kleniyor...</p>
  </div>

  <div *ngIf="error" class="error-state">
    <p>âš  {{ error }}</p>
    <button (click)="loadOrders()" class="btn-retry">ğŸ” Tekrar Dene</button>
  </div>

  <ng-container *ngIf="!isLoading && !error">
    <ng-container *ngIf="(orders$ | async) as orders">
      <div *ngIf="orders.length > 0; else noOrders" class="admin-table-container">
        <table class="admin-table">
          <thead>
            <tr>
              <th>#</th>
              <th>MÃ¼ÅŸteri Email</th>
              <th>Tarih</th>
              <th>Tutar</th>
              <th>Durum</th>
              <th>Aksiyonlar</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let order of orders">
              <td>#{{ order.id }}</td>
              <td>{{ order.user?.email || 'N/A' }}</td>
              <td>{{ order.orderDate | date: 'dd.MM.yyyy HH:mm' }}</td>
              <td>{{ order.totalAmount | currency: 'TRY':'symbol':'1.2-2' }}</td>
              <td>
                <span class="status-badge" [ngClass]="getStatusClass(order.status)">
                  {{ order.status || 'Bilinmiyor' }}
                </span>
                <span *ngIf="order.refundStatus"
                      class="refund-status"
                      [ngClass]="formatRefundClass(order.refundStatus)">
                  ({{ order.refundStatus }})
                </span>
              </td>
              <td class="action-buttons">
                <a [routerLink]="['/admin/orders/detail', order.id]"
                   class="btn-view"
                   title="SipariÅŸ DetayÄ±nÄ± GÃ¶r">
                  ğŸ“„ Detay
                </a>

                <select (change)="updateOrderStatus(order.id, $event)"
                        [disabled]="order.status === 'Ä°ptal Edildi' || order.status === 'Teslim Edildi'"
                        class="status-select"
                        title="SipariÅŸ Durumunu GÃ¼ncelle">
                  <option value="PROCESSING"
                          [selected]="['HazÄ±rlanÄ±yor', 'PROCESSING', 'PENDING'].includes(order.status)">
                    HazÄ±rlanÄ±yor
                  </option>
                  <option value="SHIPPED"
                          [selected]="['Kargoda', 'SHIPPED'].includes(order.status)">
                    Kargoda
                  </option>
                  <option value="DELIVERED"
                          [selected]="['Teslim Edildi', 'DELIVERED'].includes(order.status)">
                    Teslim Edildi
                  </option>
                </select>

                <button (click)="cancelOrder(order.id)"
                        class="btn-delete"
                        [disabled]="order.status === 'Ä°ptal Edildi' || order.status === 'Teslim Edildi'"
                        title="SipariÅŸi Ä°ptal Et">
                  âŒ Ä°ptal Et
                </button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <ng-template #noOrders>
        <p class="empty-state">ğŸš« GÃ¶sterilecek sipariÅŸ bulunamadÄ±.</p>
      </ng-template>
    </ng-container>
  </ng-container>
</div>
